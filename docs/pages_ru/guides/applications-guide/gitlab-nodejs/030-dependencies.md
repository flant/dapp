---
title: Подключение зависимостей
sidebar: applications-guide
permalink: documentation/guides/applications-guide/template/030-dependencies.html
layout: guide
---

{% filesused title="Файлы, упомянутые в главе" %}
- werf.yaml
{% endfilesused %}

Werf подразумевает, что лучшей практикой будет разделить сборочный процесс на этапы, каждый с четкими функциями и своим назначением. Каждый такой этап соответствует промежуточному образу, подобно слоям в Docker. В werf такой этап называется стадией, и конечный образ в итоге состоит из набора собранных стадий. Все стадии хранятся в хранилище стадий, которое можно рассматривать как кэш сборки приложения, хотя по сути это скорее часть контекста сборки.

Стадии — это этапы сборочного процесса, кирпичи, из которых в итоге собирается конечный образ. Стадия собирается из группы сборочных инструкций, указанных в конфигурации. Причем группировка этих инструкций не случайна, имеет определенную логику и учитывает условия и правила сборки. С каждой стадией связан конкретный Docker-образ. Подробнее о том, какие стадии для чего предполагаются можно посмотреть в [документации](https://ru.werf.io/documentation/reference/stages_and_images.html).

Werf предлагает использовать для стадий следующую стратегию:

*   использовать стадию beforeInstall для инсталляции системных пакетов;
*   использовать стадию install для инсталляции системных зависимостей и зависимостей приложения;
*   использовать стадию beforeSetup для настройки системных параметров и установки приложения;
*   использовать стадию setup для настройки приложения.

Подробно про стадии описано в [документации](https://ru.werf.io/documentation/configuration/stapel_image/assembly_instructions.html).

Одно из основных преимуществ использования стадий в том, что мы можем не перезапускать нашу сборку с нуля, а перезапускать её только с той стадии, которая зависит от изменений в определенных файлах.

В нашем случае в качестве примера мы можем взять файл `package.json`.

Те кто уже сталкивался с разработкой на nodejs приложений знают, что в файле `package.json` указываются зависимости которые нужны для сборки приложения. Потому самое логичное указать данный файл в зависимости сборки, чтобы в случае изменений в нём, была перезапущена сборка только со стадии **_install_**.

Для этого в одной из первых глав мы сразу и добавляли наш файл package.json в зависимости werf.

Код из [werf.yaml](/werf-articles/gitlab-nodejs-files/examples/werf_1.yaml):


```yaml
  stageDependencies:
    install:
    - package.json
```
Тем самым при изменении данного файла между сборками, Werf это увидит, и перезапустит стадию в которой мы прописали установку пакетов.

```yaml
  install:
  - name: npm сi
    shell: npm сi
    args:
      chdir: /app
```

<a name="dependencies-implementation" />

## Подключение менеджера зависимостей

TODO: внести сюда

<a name="dependencies-optimization" />

## Оптимизация сборки

TODO: написать, что то

